<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retro Blaster</title>
  <style>
    body {
      margin: 0; background: #080a0f; color: #e6f1ff;
      font: 16px/1.4 system-ui, sans-serif;
      display: flex; flex-direction: column; align-items: center;
    }
    #menu {
      width: 100%; max-width: 920px;
      background: linear-gradient(#0b1220, #0a0f1a);
      border-bottom: 1px solid #2a3952;
      padding: 12px; text-align: center;
    }
    #menu h1 { margin: 0 0 6px; font-size: 28px; }
    #menu .subtitle { margin: 0 0 12px; color: #7a8aaa; }
    .btn {
      display: inline-block; margin: 4px; padding: 8px 14px;
      border: 1px solid #2a3952; border-radius: 8px;
      background: #101622; color: #e6f1ff; cursor: pointer;
    }
    .btn:hover { border-color: #39608f; }
    #stats {
      display: flex; justify-content: center; gap: 20px;
      margin: 10px 0; color: #7a8aaa; font-variant-numeric: tabular-nums;
      flex-wrap: wrap;
    }
    #stats b { color: #e6f1ff; }
    #frame {
      width: min(100%, 920px); aspect-ratio: 4 / 3;
      background: #000814; border: 1px solid #1c2433; border-radius: 12px;
      position: relative; overflow: hidden; margin-top: 8px;
    }
    canvas { width: 100%; height: 100%; display: block; image-rendering: pixelated; }
    #mobileControls {
      position: absolute; left: 0; right: 0; bottom: 12px; display: none;
      gap: 12px; justify-content: center; pointer-events: none;
    }
    .touchbtn {
      pointer-events: auto; min-width: 72px;
      padding: 14px 16px; border-radius: 12px; border: 1px solid #2a3952;
      background: rgba(15,20,30,.55); color: #e6f1ff; font-weight: 700;
    }
    @media (hover:none), (max-width: 820px) {
      #mobileControls { display: flex; }
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>RETRO BLASTER</h1>
    <p class="subtitle">Ein minimalistisches Arcade-Spiel</p>
    <div>
      <button class="btn" id="startBtn">‚ñ∂Ô∏è Spiel starten</button>
      <button class="btn" id="muteBtn">üîá Ohne Sound</button>
      <button class="btn" id="restartBtn">üîÅ Neustart</button>
    </div>
    <div id="stats">
      <div>Punkte: <b id="score">0</b></div>
      <div>Leben: <b id="lives">3</b></div>
      <div>Level: <b id="level">1</b></div>
      <div>Highscore: <b id="highscore">0</b></div>
    </div>
    <p style="color:#b6c3d9;font-size:14px;margin-top:6px;">
      Steuerung: ‚Üê / ‚Üí oder A/D bewegen, Space = Feuer, P = Pause, R = Neustart
    </p>
  </div>

  <div id="frame">
    <canvas id="game" width="800" height="600"></canvas>
    <div id="mobileControls">
      <button class="touchbtn" id="leftBtn">‚Üê</button>
      <button class="touchbtn" id="fireBtn">‚óè</button>
      <button class="touchbtn" id="rightBtn">‚Üí</button>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  function fixDPI() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.round(rect.width * dpr);
    canvas.height = Math.round(rect.height * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  new ResizeObserver(fixDPI).observe(canvas);

  // HUD-Elemente
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const levelEl = document.getElementById('level');
  const highscoreEl = document.getElementById('highscore');

  // Highscore laden
  let highscore = parseInt(localStorage.getItem("retroblaster_highscore") || "0");
  highscoreEl.textContent = highscore;

  const startBtn = document.getElementById('startBtn');
  const muteBtn = document.getElementById('muteBtn');
  const restartBtn = document.getElementById('restartBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const fireBtn = document.getElementById('fireBtn');

  let mute = false;

  // Spielwelt
  const world = {
    player:{x:380,y:550,w:40,h:20,lives:3,cooldown:0},
    bullets:[], aliens:[], alienBullets:[],
    shields:[], score:0, level:1, over:false, paused:false
  };

  function reset(){
    world.player.x = canvas.width/2-20;
    world.player.lives = 3; world.score=0; world.level=1;
    world.over=false; world.paused=false;
    world.bullets=[]; world.alienBullets=[];
    initAliens(); initShields(); syncHUD();
  }

  function syncHUD(){
    scoreEl.textContent = world.score;
    livesEl.textContent = world.player.lives;
    levelEl.textContent = world.level;
    highscoreEl.textContent = highscore;
  }

  function updateHighscore(){
    if(world.score > highscore){
      highscore = world.score;
      localStorage.setItem("retroblaster_highscore", highscore);
    }
  }

  function initAliens(){
    world.aliens=[];
    const rows=4, cols=8, spacing=60;
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        world.aliens.push({x:100+c*spacing,y:50+r*50,w:30,h:20,dir:1});
      }
    }
  }

  function initShields(){
    world.shields=[];
    for(let i=0;i<4;i++){
      world.shields.push({x:100+i*180,y:450,w:60,h:20,hp:5});
    }
  }

  function rectsCollide(a,b){
    return a.x<a.x+b.w && a.x+a.w>b.x && a.y<a.y+b.h && a.y+a.h>b.y;
  }

  function update(){
    if(world.over||world.paused) return;

    if(world.player.cooldown>0) world.player.cooldown--;

    world.bullets.forEach(b=>b.y-=8);
    world.bullets=world.bullets.filter(b=>b.y>-20);

    world.alienBullets.forEach(b=>b.y+=5);
    world.alienBullets=world.alienBullets.filter(b=>b.y<canvas.height+20);

    world.aliens.forEach(a=>a.x+=a.dir);
    if(world.aliens.some(a=>a.x<20||a.x>canvas.width-40)){
      world.aliens.forEach(a=>{a.dir*=-1;a.y+=20;});
    }

    if(Math.random()<0.01&&world.aliens.length>0){
      const shooter=world.aliens[Math.floor(Math.random()*world.aliens.length)];
      world.alienBullets.push({x:shooter.x+15,y:shooter.y+20,w:4,h:10});
    }

    world.bullets.forEach(b=>{
      world.aliens.forEach((a,i)=>{
        if(rectsCollide(b,a)){
          world.aliens.splice(i,1);
          b.dead=true; world.score+=10;
        }
      });
    });
    world.bullets=world.bullets.filter(b=>!b.dead);

    world.bullets.forEach(b=>{
      world.shields.forEach(s=>{
        if(s.hp>0&&rectsCollide(b,s)){s.hp--;b.dead=true;}
      });
    });
    world.alienBullets.forEach(b=>{
      world.shields.forEach(s=>{
        if(s.hp>0&&rectsCollide(b,s)){s.hp--;b.dead=true;}
      });
    });
    world.bullets=world.bullets.filter(b=>!b.dead);
    world.alienBullets=world.alienBullets.filter(b=>!b.dead);

    if(world.alienBullets.some(b=>rectsCollide(b,world.player))){
      world.player.lives--; world.alienBullets=[];
      if(world.player.lives<=0){world.over=true;}
    }

    if(world.aliens.length===0){
      world.level++; initAliens(); initShields();
    }

    updateHighscore();
    syncHUD();
  }

  function render(){
    ctx.fillStyle="#000814"; ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="#39f"; ctx.fillRect(world.player.x,world.player.y,world.player.w,world.player.h);

    ctx.fillStyle="#fff"; world.bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

    ctx.fillStyle="#f33"; world.alienBullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

    ctx.fillStyle="#0f0"; world.aliens.forEach(a=>ctx.fillRect(a.x,a.y,a.w,a.h));

    world.shields.forEach(s=>{
      if(s.hp>0){
        ctx.fillStyle=`rgba(0,200,255,${s.hp/5})`;
        ctx.fillRect(s.x,s.y,s.w,s.h);
      }
    });

    if(world.over){
      ctx.fillStyle="red"; ctx.font="40px sans-serif";
      ctx.fillText("GAME OVER",canvas.width/2-120,canvas.height/2);
    } else if(world.paused){
      ctx.fillStyle="yellow"; ctx.font="30px sans-serif";
      ctx.fillText("PAUSE",canvas.width/2-60,canvas.height/2);
    }
  }

  function loop(){update();render();requestAnimationFrame(loop);}

  const keys={};
  document.addEventListener("keydown",e=>{
    if(["ArrowLeft","ArrowRight","a","d"," ","p","r"].includes(e.key)){e.preventDefault();}
    keys[e.key]=true;
    if(e.key===" "&&!world.over&&!world.paused&&world.player.cooldown===0){
      world.bullets.push({x:world.player.x+18,y:world.player.y,w:4,h:10});
      world.player.cooldown=15;
    }
    if(e.key==="p") world.paused=!world.paused;
    if(e.key==="r") reset();
  });
  document.addEventListener("keyup",e=>{keys[e.key]=false;});

  function handleInput(){
    if(keys["ArrowLeft"]||keys["a"]) world.player.x-=5;
    if(keys["ArrowRight"]||keys["d"]) world.player.x+=5;
    world.player.x=Math.max(0,Math.min(canvas.width-world.player.w,world.player.x));
  }

  function gameLoop(){handleInput();update();render();requestAnimationFrame(gameLoop);}

  startBtn.addEventListener("click",()=>{reset();});
  restartBtn.addEventListener("click",()=>{reset();});
  muteBtn.addEventListener("click",()=>{mute=!mute;});

  leftBtn.addEventListener("touchstart",()=>{keys["ArrowLeft"]=true;});
  leftBtn.addEventListener("touchend",()=>{keys["ArrowLeft"]=false;});
  rightBtn.addEventListener("touchstart",()=>{keys["ArrowRight"]=true;});
  rightBtn.addEventListener("touchend",()=>{keys["ArrowRight"]=false;});
  fireBtn.addEventListener("touchstart",()=>{
    if(world.player.cooldown===0){
      world.bullets.push({x:world.player.x+18,y:world.player.y,w:4,h:10});
      world.player.cooldown=15;
    }
  });

  reset(); gameLoop();
})();
</script>
</body>
</html>
